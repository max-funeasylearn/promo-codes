System.register(["angular2/core","angular2/http","rxjs/add/operator/map","./vars"],function(e,t){"use strict";var o,r,i,n,s=(t&&t.id,this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),p=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var p=e.length-1;p>=0;p--)(i=e[p])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};return{setters:[function(e){o=e},function(e){r=e},function(e){},function(e){i=e}],execute:function(){n=function(e){function t(t){this.error="",this.message="",this.form_title="Generate Promo Codes",this.promo_code_type_id=0,this.project_name="",this.comment="",this.number_of_codes="",this.value="",this.promo_code_types=[],this.export_received=!1,this.export_link="",this.http=t,this.getPromoCodeTypes(),e.call(this)}return s(t,e),t.prototype.getPromoCodeTypes=function(){var e=this;this.http.get("/promo_code_types").map(function(e){return e.json()}).subscribe(function(t){return e.getPromoCodeTypesCallback(t)})},t.prototype.selectPromoCodeType=function(e){for(var t in this.promo_code_types)if(this.promo_code_types[t].promo_code_type_id==parseInt($(e).val())){this.project_name=this.promo_code_types[t].project_name,this.comment=this.promo_code_types[t].comment;break}},t.prototype.save=function(e){var t=this;this.disableForm(),this.export_received=!1,this.error="",this.message="",this.http.post("/promo_codes/generate",JSON.stringify({promo_code_type_id:this.promo_code_type_id,number_of_codes:this.number_of_codes,value:this.value}),{headers:{"Content-Type":"application/json"}}).map(function(e){return e.json()}).subscribe(function(e){return t.saveCallback(e)})},t.prototype.checkExportFile=function(){var e=this;this.http.get("/check_export_file").map(function(e){return e.json()}).subscribe(function(t){return e.checkExportFileCallback(t)})},t.prototype.removeExportFile=function(){var e=this;if(!confirm("Are you sure?"))return!1;this.http.get("/remove_export_file").map(function(e){return e.json()}).subscribe(function(t){return e.removeExportFileCallback(t)})},t.prototype.getPromoCodeTypesCallback=function(e){void 0===e.error?this.promo_code_types=e:(this.promo_code_types=[],this.error=e.error)},t.prototype.saveCallback=function(e){void 0===e.error?(this.export_received=!0,this.message="Promo codes successfully generated",this.checkExportFile()):this.error=e.error,this.enableForm()},t.prototype.checkExportFileCallback=function(e){1==parseInt(e.file_exists)&&(this.export_link=e.export_link)},t.prototype.removeExportFileCallback=function(e){1==parseInt(e.success)&&(this.export_link="")},t.prototype.disableForm=function(){$("form#promo_code_generate_form input, form#promo_code_generate_form select, form#promo_code_generate_form button").attr("disabled",!0),$('form#promo_code_generate_form button[type="submit"]').after('<p class="text-muted" id="generating_label">Generating...</p>')},t.prototype.enableForm=function(){$("form#promo_code_generate_form input, form#promo_code_generate_form select, form#promo_code_generate_form button").attr("disabled",!1),$("form#promo_code_generate_form").find("#generating_label").remove()},t.prototype.onDisplay=function(){this.message="",this.error="",this.export_received=!1,this.promo_code_type_id=0,this.project_name="",this.comment="",this.number_of_codes="",this.value="",this.checkExportFile()},t=p([o.Component({selector:"main-container#promo_codes_generate_form",viewProviders:[r.HTTP_PROVIDERS],templateUrl:"partials/promo_codes_generate_form.html"}),c("design:paramtypes",[r.Http])],t)}(i.Vars),e("PromoCodesGenerateComponent",n)}}});