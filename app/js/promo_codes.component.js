System.register(["angular2/core","angular2/http","rxjs/add/operator/map","./vars"],function(t,e){"use strict";var o,r,s,i,a=(e&&e.id,this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),c=this&&this.__decorate||function(t,e,o,r){var s,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(s=t[c])&&(a=(i<3?s(a):i>3?s(e,o,a):s(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};return{setters:[function(t){o=t},function(t){r=t},function(t){},function(t){s=t}],execute:function(){i=function(t){function e(e){this.error="",this.message="",this.info="",this.promo_codes=[],this.users=[],this.project_names=[],this.promo_code_types=[],this.sort={by:"promo_code_id",direction:"DESC"},this.pagination={page:1,pages:[1]},this.filters=[],this.http=e,t.call(this)}return a(e,t),e.prototype.showForm=function(t,e){$("main-container").hide(),$("main-container#promo_code_form").show(),void 0!==e?($("#promo_code_form_title").text("Edit Promo Code"),$("#save_promo_code_button").text("Save"),$("#promo_code_id").val(e.promo_code_id),$('#promo_code_type_id option[value="'+e.promo_code_type_id+'"]').attr("selected","selected"),$("#promo_code").val(e.promo_code),$("#generated_promo_code").val(e.promo_code),$("#value").val(e.value)):($("#promo_code_form_title").text("New Promo Code"),$("#save_promo_code_button").text("Create"),$("#promo_code_id").val(0),$("#promo_code_type_id").val(""),$("#promo_code").val(""),$("#generated_promo_code").val(""),$("#value").val("")),document.querySelector("form#promo_code_form").dispatchEvent(new Event("display"))},e.prototype.showGenerateForm=function(t){$("main-container").hide(),$("main-container#promo_codes_generate_form").show(),document.querySelector("form#promo_code_generate_form").dispatchEvent(new Event("display"))},e.prototype.sortTable=function(t){t=$(t).closest("a"),this.sort.by!=t.data("by")?this.sort.direction="ASC":"ASC"==this.sort.direction?this.sort.direction="DESC":this.sort.direction="ASC",this.sort.by=t.data("by"),console.log(this.sort),$("#promo_codes thead a span.fa").removeClass("fa-sort-desc").removeClass("fa-sort-asc").addClass("fa-sort"),this.pagination={page:1,pages:[1]},this.get()},e.prototype.filterTable=function(t){this.filters=$("select.filter").map(function(){return"0"==$(this).val()?null:{by:$(this).data("by"),value:$(this).val()}}).get(),this.pagination={page:1,pages:[1]},this.get()},e.prototype.get=function(){var t=this,e="";if(this.filters.length>0)for(var o in this.filters)e+="&filter_by[]="+this.filters[o].by+"&filter_value[]="+this.filters[o].value;this.http.get("/promo_codes?by="+this.sort.by+"&direction="+this.sort.direction+"&page="+this.pagination.page+e).map(function(t){return t.json()}).subscribe(function(e){return t.getCallback(e)})},e.prototype.getUsers=function(){var t=this;this.http.get("/users").map(function(t){return t.json()}).subscribe(function(e){return t.getUsersCallback(e)})},e.prototype.getProjectNames=function(){var t=this;this.http.get("/projects/project_names").map(function(t){return t.json()}).subscribe(function(e){return t.getProjectNamesCallback(e)})},e.prototype.getPromoCodeTypes=function(){var t=this;this.http.get("/promo_code_types").map(function(t){return t.json()}).subscribe(function(e){return t.getPromoCodeTypesCallback(e)})},e.prototype.getPage=function(t){this.pagination.page=t,this.get()},e.prototype.delete=function(t){var e=this;if(!confirm("Are you sure?"))return!1;this.http.post("/promo_codes/delete",JSON.stringify({promo_code_ids:t}),{headers:{"Content-Type":"application/json"}}).map(function(t){return t.json()}).subscribe(function(t){return e.deleteCallback(t)})},e.prototype.markAsNotValid=function(t){var e=this;if(!confirm("Are you sure?"))return!1;this.http.post("/promo_codes/mark_as_not_valid",JSON.stringify({promo_code_ids:t}),{headers:{"Content-Type":"application/json"}}).map(function(t){return t.json()}).subscribe(function(t){return e.markAsNotValidCallback(t)})},e.prototype.bulkDelete=function(){var t=[];$(".promo_code_checkbox:checked").each(function(){t.push($(this).val())}),this.delete(t)},e.prototype.bulkMarkAsNotValid=function(){var t=[];$(".promo_code_checkbox:checked").each(function(){t.push($(this).val())}),this.markAsNotValid(t)},e.prototype.onDisplay=function(){this.message="",this.error="",this.info="",this.get(),this.getUsers(),this.getProjectNames(),this.getPromoCodeTypes()},e.prototype.checkAll=function(){$("input.promo_code_checkbox").length>$("input.promo_code_checkbox:checked").length?$("#promo_code_all_checkbox").is(":checked")?$("input.promo_code_checkbox").prop("checked",!0):$("input.promo_code_checkbox").prop("checked",!1):$("#promo_code_all_checkbox").is(":checked")||$("input.promo_code_checkbox").prop("checked",!1)},e.prototype.getCallback=function(t){if(void 0===t.error){this.promo_codes=t.results,$("#promo_code_all_checkbox").prop("checked",!1),0==this.promo_codes.length?this.info="Empty result":this.info="",this.pagination.pages=[];for(var e=1;e<=t.total_pages;e++)this.pagination.pages.push(e);$(".pagination li").removeClass("active"),$(".pagination li").eq(this.pagination.page-1).addClass("active");for(var e in this.promo_codes)this.promo_codes[e].date_created=new Date(this.promo_codes[e].date_created);switch(this.sort.direction){case"ASC":$('#promo_codes thead a[data-by="'+this.sort.by+'"] span').addClass("fa-sort-asc");break;case"DESC":$('#promo_codes thead a[data-by="'+this.sort.by+'"] span').addClass("fa-sort-desc")}}else this.promo_codes=[],this.error=t.error},e.prototype.deleteCallback=function(t){void 0===t.error?($("#promo_code_all_checkbox").prop("checked",!1),this.message="Promo codes successfully deleted",this.get()):this.error=t.error},e.prototype.markAsNotValidCallback=function(t){void 0===t.error?(this.message="Promo codes successfully marked as not valid",this.get()):this.error=t.error},e.prototype.getUsersCallback=function(t){void 0===t.error&&(this.users=t)},e.prototype.getProjectNamesCallback=function(t){void 0===t.error&&(this.project_names=t)},e.prototype.getPromoCodeTypesCallback=function(t){void 0===t.error&&(this.promo_code_types=t)},e=c([o.Component({selector:"main-container#promo_codes",viewProviders:[r.HTTP_PROVIDERS],templateUrl:"partials/promo_codes.html"}),n("design:paramtypes",[r.Http])],e)}(s.Vars),t("PromoCodesComponent",i)}}});